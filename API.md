# 
# API
Class methods can be used by classes inheriting from Model.
Instance methods can be used by the instances of classes inheriting from Model.

## Class methods

### `model_obj:getIdByIndex (index)`  
Return the id of instance whose index field equals `index`.  
Index field is declared by `model_obj.__indexfd`. If undeclared, it is the id field.  

### `model_obj:getIndexById (id)`  
Return the `index` of instance whose id equals `id`.  
Index field is declared by `model_obj.__indexfd`. If undeclared, it is the id field.  

### `model_obj:getById (id)`  
Return the instance whose id equals `id`.

### `model_obj:getByIndex (index)`  
Return the instance whose index field equals `index`.

### `model_obj:allIds (is_rev)`  
Return all instance ids. Reversed when `is_rev` equals 'rev'.  

### `model_obj:sliceIds (start, stop, is_rev)`  
Return a slice of instance ids from `start` to `stop`. Reversed when `is_rev` equals 'rev'.  
`start` is optional, can be positive bigger than 0 or negetive.  
`stop` is optional, can be positive bigger than 'start' or negetive.

### `model_obj:all (is_rev)`  
Return all instances. Reversed when `is_rev` equals 'rev'.

### `model_obj:slice (start, stop, is_rev)`  
Return a slice of instances from `start` to `stop`. Reversed when `is_rev` equals 'rev'.  
`start` is optional, can be positive bigger than 0 or negetive.  
`stop` is optional, can be positive bigger than `start` or negetive.

### `model_obj:numbers ()`  
Return the number of all instances of `model_obj`.

### `model_obj:get (query, is_rev)`  
Return the first(last when `is_rev` equals 'rev') instance which matches the condition _query_. 
  
### `model_obj:filter (query, is_rev, starti, length, dir)`  
Return instances which matches the condition `query`. Reversed when `is_rev` equals 'rev'.  
_starti_ is optional, means the beginning of query range.  
`length` is optional, means the range length of query range.  
`dir` is optional, 1 means query from `starti` to `starti`+`length`, -1 means query from `starti` to `starti`-`length`.

### `model_obj:setCustom (key, val, st)`  
Store a key-value pair to redis.    
`key`, `val` mean the key and value of the pair.
`st` means the storage type of value. If `st` equals 'LIST', `val` should be a LIST, else, `val` should be a string.

### `model_obj:getCustom (key, st)`  
Return the value of `key` set by `model_obj:setCustom (key, val, st)`.   
`st` means the storage type of value. If value is a LIST, `st` should equal 'LIST'.

### `model_obj:delCustom (key)`  
Delete the key-value pair set by `model_obj:setCustom (key, val, st)`.  

### `model_obj:updateCustom (key, val)`
Update the value of `key` to `val` set by `model_obj:setCustom (key, val, st)`.   

### `model_obj:validate (params)`  
Return true when `params` is valid, else, return false, err\_msg.  
`params` is a key-value table, usually generated by `Form:parse(req)`.  
`err\_msg` is a table contains the error messages.

====================================================================== 

## Instance methods
### `instance_obj:save ()`  
Save `instance_obj` to database.  
Return `instance_obj`.

### `instance_obj:update (field, new_value)`  
Update `field` of `instance_obj` to new\_value.  
Return `instance_obj`.  
Noteï¼š This function cannot be used to foreign fields.

### `instance_obj:del ()`  
Delete `instance_obj` from database.  
Note: To delete an instance from database, you should firstly get the instance from database.

### `instance_obj:addForeign(field, new_obj)`  
Add foreign instance `new_obj` to `field`. `instance_obj.__fields.field` must contains foreign attrs.  
Return `instance_obj`.  
Note: Foreign field only save the id of foreign instance, to input the instance increase the reliability.

### `instance_obj:getForeign (field, start, stop, is_rev)`  
Return instances in `field` of `instance_obj` from 'start' to `stop`. Reversed when `is_rev` equals 'rev'.

### `instance_obj:delForeign (field, fr_obj)`  
Delete `fr_obj` from `field` of `instance_obj`.
Return `instance_obj`.

### `instance_obj:numForeign (field)`  
Return the number of foreign instances in `field` of `instance_obj`.

### `instance_obj:toHtml(params)`  
Return the html output of `instance_obj`.  
`params` is a parameter table, available keys contain `field`, `filters`, `attached`, `format`.  
`field` means which field you want to generate html element, all fields when `nil`.  
`filters` means which fields you want to generate html elements, all fields when `nil`.  
`attached` means extra information adding to field describe table.  
`format` means how the html elements will be generated, such as `'$label: $widget$help'`
