<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>API.md</title>

</head>

<body>

<p>本文档中的所有类方法都可以供所有继承自Model的类使用，所有实例方法可供所有这些类以及类的实例使用。 
Class methods can be used by classes inheriting from Model.
Instance methods can be used by classes inheriting from Model and instances of those classes.</p>

<h2>Class methods</h2>

<p><code>model_obj:getIdByIndex (index)</code> <br />
Return the id of instance whose index field equals <code>index</code>. <br />
Index field is declared by <code>model_obj.__indexfd</code>. If undeclared, it is the id field.  </p>

<p><code>model_obj:getIndexById (id)</code> <br />
Return the <code>index</code> of instance whose id equals <code>id</code>. <br />
Index field is declared by <code>model_obj.__indexfd</code>. If undeclared, it is the id field.  </p>

<p><code>model_obj:getById (id)</code> <br />
Return the instance whose id equals <code>id</code>.</p>

<p><code>model_obj:getByIndex (index)</code> <br />
Return the instance whose index field equals <code>index</code>.</p>

<p><code>model_obj:allIds (is_rev)</code> <br />
Return all instance ids. Reversed when <code>is_rev</code> equals 'rev'.  </p>

<p><code>model_obj:sliceIds (start, stop, is_rev)</code> <br />
Return a slice of instance ids from <code>start</code> to <code>stop</code>. Reversed when <code>is_rev</code> equals 'rev'. <br />
<code>start</code> is optional, can be positive bigger than 0 or negetive. <br />
<code>stop</code> is optional, can be positive bigger than 'start' or negetive.</p>

<p><code>model_obj:all (is_rev)</code> <br />
Return all instances. Reversed when <code>is_rev</code> equals 'rev'.</p>

<p><code>model_obj:slice (start, stop, is_rev)</code> <br />
Return a slice of instances from <code>start</code> to <code>stop</code>. Reversed when <code>is_rev</code> equals 'rev'. <br />
<code>start</code> is optional, can be positive bigger than 0 or negetive. <br />
<code>stop</code> is optional, can be positive bigger than <code>start</code> or negetive.</p>

<p><code>model_obj:numbers ()</code> <br />
Return the number of all instances of <code>model_obj</code>.</p>

<p><code>model_obj:get (query, is_rev)</code> <br />
Return the first(last when <code>is_rev</code> equals 'rev') instance which matches the condition <em>query</em>. </p>

<p><code>model_obj:filter (query, is_rev, starti, length, dir)</code> <br />
Return instances which matches the condition <code>query</code>. Reversed when <code>is_rev</code> equals 'rev'. <br />
<em>starti</em> is optional, means the beginning of query range. <br />
<code>length</code> is optional, means the range length of query range. <br />
<code>dir</code> is optional, 1 means query from <code>starti</code> to <code>starti</code>+<code>length</code>, -1 means query from <code>starti</code> to <code>starti</code>-<code>length</code>.</p>

<p><code>model_obj:setCustom (key, val, st)</code> <br />
Store a key-value pair to redis. <br />
<code>key</code>, <code>val</code> mean the key and value of the pair.
<code>st</code> means the storage type of value. If <code>st</code> equals 'LIST', <code>val</code> should be a LIST, else, <code>val</code> should be a string.</p>

<p><code>model_obj:getCustom (key, st)</code> <br />
Return the value of <code>key</code> set by <code>model_obj:setCustom (key, val, st)</code>. <br />
<code>st</code> means the storage type of value. If value is a LIST, <code>st</code> should equal 'LIST'.</p>

<p><code>model_obj:delCustom (key)</code> <br />
Delete the key-value pair set by <code>model_obj:setCustom (key, val, st)</code>.  </p>

<p><code>model_obj:updateCustom (key, val)</code>
Update the value of <code>key</code> to <code>val</code> set by <code>model_obj:setCustom (key, val, st)</code>.   </p>

<p><code>model_obj:validate (params)</code> <br />
Return true when <code>params</code> is valid, else, return false, err_msg. <br />
<code>params</code> is a key-value table, usually generated by <code>Form:parse(req)</code>. <br />
<code>err\_msg</code> is a table contains the error messages.</p>

<p>====================================================================== </p>

<h2>Instance methods</h2>

<p><code>instance_obj:save ()</code> <br />
Save <code>instance_obj</code> to database. <br />
Return <code>instance_obj</code>.</p>

<p><code>instance_obj:update (field, new_value)</code> <br />
Update <code>field</code> of <code>instance_obj</code> to new_value. <br />
Return <code>instance_obj</code>. <br />
Note： This function cannot be used to foreign fields.</p>

<p><code>instance_obj:del ()</code> <br />
Delete <code>instance_obj</code> from database. <br />
Note: To delete a instance from database, you should firstly get the instance from database.</p>

<p><code>instance_obj:addForeign(field, new_obj)</code> <br />
Add foreign instance <code>new_obj</code> to <code>field</code>. <code>instance_obj.__fields.field</code> must contains foreign attrs. <br />
Return <code>instance_obj</code>. <br />
Note: Foreign field only save the id of foreign instance, to input the instance increase the reliability.</p>

<p><code>instance_obj:getForeign (field, start, stop, is_rev)</code> <br />
Return instances in <code>field</code> of <code>instance_obj</code> from 'start' to <code>stop</code>. Reversed when <code>is_rev</code> equals 'rev'.</p>

<p><code>instance_obj:delForeign (field, fr_obj)</code> <br />
Delete <code>fr_obj</code> from <code>field</code> of <code>instance_obj</code>.
Return <code>instance_obj</code>.</p>

<p><code>instance_obj:numForeign (field)</code> <br />
Return the number of foreign instances in <code>field</code> of <code>instance_obj</code></p>

<h3><code>instance_obj:toHtml()</code></h3>

</body>
</html>
