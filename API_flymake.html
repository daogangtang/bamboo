<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>API.md</title>

</head>

<body>

<p>本文档中的所有类方法都可以供所有继承自Model的类使用，所有实例方法可供所有这些类以及类的实例使用。 
Class methods can be used by classes inheriting from Model.
Instance methods can be used by classes inheriting from Model and instances of those classes.</p>

<h2>Class methods</h2>

<p><code>model_obj:getIdByIndex (index)</code> <br />
Return the id of instance whose index field equals <em>index</em>. <br />
Index field is declared by model.__indexfd. If undeclared, it is the id field.  </p>

<p><code>model_obj:getIndexById (id)</code> <br />
Return the <em>index</em> of instance whose id equals <em>id</em>. <br />
Index field is declared by model.__indexfd. If undeclared, it is the id field.  </p>

<p><code>model_obj:getById (id)</code> <br />
Return the instance whose id equals <em>id</em>.</p>

<p><code>model_obj:getByIndex (index)</code> <br />
Return the instance whose index field equals <em>index</em>.</p>

<p><code>model_obj:allIds (is_rev)</code> <br />
Return all instance ids. Reversed when <em>is_rev</em> equals 'rev'.  </p>

<p><code>model_obj:sliceIds (start, stop, is_rev)</code> <br />
Return a slice of instance ids from <em>start</em> to <em>stop</em>. Reversed when <em>is_rev</em> equals 'rev'. <br />
<em>start</em> is optional, can be positive bigger than 0 or negetive. <br />
<em>stop</em> is optional, can be positive bigger than <em>start</em> or negetive.</p>

<p><code>model_obj:all (is_rev)</code> <br />
Return all instances. Reversed when <em>is_rev</em> equals 'rev'.</p>

<p><code>model_obj:slice (start, stop, is_rev)</code> <br />
Return a slice of instances from <em>start</em> to <em>stop</em>. Reversed when <em>is_rev</em> equals 'rev'. <br />
<em>start</em> is optional, can be positive bigger than 0 or negetive. <br />
<em>stop</em> is optional, can be positive bigger than <em>start</em> or negetive.</p>

<p><code>model_obj:numbers ()</code> <br />
Return the number of all instances of model_obj.</p>

<p><code>model_obj:get (query, is_rev)</code> <br />
Return the first(last when <em>is_rev</em> equals 'rev') instance which matches the condition <em>query</em>. </p>

<p><code>model_obj:filter (query, is_rev, starti, length, dir)</code> <br />
Return instances which matches the condition <em>query</em>. Reversed when <em>is_rev</em> equals 'rev'. <br />
<em>starti</em> is optional, means the beginning of query range. <br />
<em>length</em> is optional, means the range length of query range. <br />
<em>dir</em> is optional, 1 means query from <em>starti</em> to <em>starti</em>+<em>length</em>, -1 means query from <em>starti</em> to <em>starti</em>-<em>length</em>.</p>

<p><code>model_obj:setCustom (key, val, st)</code> <br />
Store a key-value pair to redis. <br />
<em>key</em>, <em>val</em> mean the key and value of the pair.
<em>st</em> means the storage type of value. If <em>st</em> equals 'LIST', <em>val</em> should be a LIST, else, <em>val</em> should be a string.</p>

<p><code>model_obj:getCustom (key, st)</code> <br />
Return the value of <em>key</em> set by <code>model_obj:setCustom (key, val, st)</code>. <br />
<em>st</em> means the storage type of value. If value is a LIST, <em>st</em> should equal 'LIST'.</p>

<p><code>model_obj:delCustom (key)</code> <br />
Delete the key-value pair set by <code>model_obj:setCustom (key, val, st)</code>.  </p>

<p><code>model_obj:updateCustom (key, val)</code>
Update the value of <em>key</em> to <em>val</em> set by <code>model_obj:setCustom (key, val, st)</code>.   </p>

<p><code>model_obj:validate (params)</code> <br />
Return true when <em>params</em> is valid, else, return false, err_msg. <br />
<em>params</em> is a key-value table, usually generated by <code>Form:parse(req)</code>. <br />
<em>err_msg</em> is a table contains the error messages.</p>

<p>====================================================================== </p>

<h2>Instance methods</h2>

<p><code>instance_obj:save ()</code> <br />
Save <em>instance_obj</em> to database. <br />
Return <em>instance_obj</em>.</p>

<p><code>instance_obj:update (field, new_value)</code> <br />
Update <em>field</em> of <em>instance_obj</em> to new_value. <br />
Return <em>instance_obj</em>. <br />
Note： This function cannot be used to foreign fields.</p>

<p><code>instance_obj:del ()</code> <br />
Delete <em>instance_obj</em> from database. <br />
Note: To delete a instance from database, you should firstly get the instance from database.</p>

<p><code>instance_obj:addForeign(field, new_obj)</code> <br />
Add foreign instance <em>new_obj</em> to <em>field</em>. <em>instance_obj</em>.__fields.<em>field</em> must contains foreign attrs. <br />
Return <em>instance_obj</em>. <br />
Note: Foreign field only save the id of foreign instance, to input the instance increase the reliability.</p>

<p><code>instance_obj:getForeign (field, start, stop, is_rev)</code> <br />
Return instances in <em>field</em> of instance_obj from <em>start</em> to <em>stop</em>. Reversed when <em>is_rev</em> equals 'rev'.</p>

<p><code>instance_obj:delForeign (field, fr_obj)</code> <br />
Delete <code>fr_obj</code> from <code>field</code> of <code>instance_obj</code>.
Return <code>instance_obj</code></p>

<p>得到本对象外键域当前外键的数目 
Lua代码 <br />
instance_obj:numForeign (field)     返回当前外键域中的外链对象的数目，整数  </p>

<p>field:  外键域  </p>

<p>根据域名称获取相应的字段的信息 
Lua代码 <br />
instance_obj:fieldInfo (field)      返回指定域在模型定义时的信息  </p>

<p>field:  域名称，字符串 </p>

</body>
</html>
